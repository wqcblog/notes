## 各类IP地址的网络号字段和主机号字段

<img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651976163.png" alt="image-20220508101603653" style="zoom: 80%;" />

## 常用的三种IP地址

| 网络类别 | 最大可指派的网络数 | 第一个可指派的网络号 | 最后一个可指派的网络号 | 每个网络中最大主机数 |
| -------- | ------------------ | -------------------- | ---------------------- | -------------------- |
| A        | 126 (2^7– 2)       | 1                    | 126                    | 16777214             |
| B        | 16383 (2^14 – 1)   | 128.1                | 191.255                | 65534                |
| C        | 2097151 (2^21 – 1) | 192.0.1              | 223.255.255            | 254                  |

- 分配时只分配网络号，剩下的主机号由该网络号的单位自行分配。

- 一个主机若同时连接到两个网络，该主机必须同时具有两个相应的IP地址，其网络号net-id必须是不同的(多归属主机)
- 一个路由器至少应当连接到两个网络(至少有两个不同的ip地址)，这样才能将IP数据包从一个网络转发到另一个网络。
- 路由器总是具有两个或两个以上的IP地址，路由器的每一个接口都有一个不同网络号的IP地址。(同一个局域网上的主机或网络号必须是一样的)
- 路由器根据目的站的IP地址的网络号进行路由选择，分析是否需要路由器转发进行下一跳。(同一局域网内的主机直接通信，不需要路由器转发)。

## 特殊的IP地址

| 网络号 | 主机号                 | 源地址使用 | 目的地址使用 | 代表的意思                               |
| ------ | ---------------------- | ---------- | ------------ | ---------------------------------------- |
| 0      | 0                      | 可以       | 不可         | 在本网络上的本主机                       |
| 0      | host-id                | 可以       | 不可         | 在本网络上的某台主机 host-id             |
| 全 1   | 全 1                   | 不可       | 可以         | 只在本网络上进行广播（各路由器均不转发） |
| net-id | 全 1                   | 不可       | 可以         | 对 net-id 上的所有主机进行广播           |
| 127    | 非全 0 或全 1 的任何数 | 可以       | 可以         | 用于本地软件环回测试                     |

注意：

- 硬件地址(或物理地址)是数据链路层和物理层(接口层)使用的地址。(交换机转发时自动学习记录试错记录源地址及接口)

- IP地址是网络层和以上各层使用的地址，是一种逻辑地址(IP地址是软件实现的)

- 路由器-网络层(分组交换)，交换机-数据链路层(电路交换)，集线器-物理层

  <img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651977620.png" alt="image-20220508104020008" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651977663.png" alt="image-20220508104103067" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651977752.png" alt="image-20220508104232300" style="zoom:80%;" />

## 地址解析协议ARP

通信时使用两个地址:

- ip地址(网络层地址)
- MAC地址(数据链路层地址)(根据网络层使用的IP地址解析出在数据链路层使用的硬件地址)

**注意：**

- 网络层中传送数据帧时，必须使用到硬件地址。

- 每台主机都设有ARP高速缓存，里面有所在的局域网上的各主机和路由器的IP地址到硬件地址的映射表(通过广播请求分组进行建立)(本地广播ARP请求，路由器不进行转发)(写入目的网络及下一跳接口)。

> < IP address；MAC address；TTL >

**注意：**

需要通过路由器转发时不将下一跳路由器的IP地址填入IP数据报，而是递交给下层的网络接口软件，使用ARP将下一跳路由器的IP地址转换为硬件地址，该地址放置在链路层的MAC帧首部，根据该地址可以找到下一跳路由器。

## 划分子网

从主机号借用若干位作为子网号subnet-id，而主机号host-id相应减少若干位。

![image-20220508114249583](https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651981369.png)

**注意：**

- 划分子网，将IP地址的两级结构变为三级结构
- 划分子网只是把 IP 地址的主机号 host-id 这部分进行再划分，而不改变 IP 地址原来的网络号 net-id。(只是单位内部的事情，对外网络透明，仍然表现为没有划分子网的一个网络)。

**子网掩码(subnet mask) **：

**默认：**共32位，网络号置为1，主机号置为0

<img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651982126.png" alt="image-20220508115525846" style="zoom:80%;" />

**求子网的网络地址：**

IP地址和子网掩码进行或运算。(全1不变，全0置0)

**注意：**

路由器在和相邻路由器交换路由信息时，必须把自己所在网络（或子网）的子网掩码告诉相邻路由器。

一个路由器连接在两个子网上，就拥有两个网络地址和两个子网掩码。

在分析Ping通的问题需要结合子网掩码算出网络地址进行分析。

**路由器在进行转发的过程：**(根据路由表中存储的信息进行转发)

分析网络地址是否与路由表中存储的目的网络地址相匹配。

<img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651983390.png" alt="image-20220508121629969" style="zoom:80%;" />

## 无分类编址CIDR

消除传统的的A类，B类和C类地址以及划分子网的概念，使用各种长度的网络前缀(network-prefix)来代替分类地址中的网络号和子网号，回到了两级编址。

![image-20220508122621316](https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651983981.png)

在 IP 地址面加上一个斜线“/”，然后写上**网络前缀所占的位数(保持不变)**。

128.14.32.0/20 

地址块的最小地址：128.14.32.0(最小地址以指明的为准)

地址块的最大地址：128.14.47.255(最大地址网络前缀不变，主机号置1)

**注意：**

CIDR地址块可以表示很多地址，这种地址的聚合称为路由聚合(构成超网)，减少路由器之间的路由选择信息的交换，提高了整个互联网的性能。

CIDR不使用子网但仍然使用掩码这一名词**(掩码:网络前缀全部置为1，主机号置为0)(网络地址计算同上)。**

**CIDR记法的其他表现形式**

- 10.0.0.0/10 可简写为 10/10，也就是把点分十进制中低位连续的 0 省略。
- 网络前缀的后面加一个星号 * 的表示方法，如 00001010 00*，在星号 * 之前是网络前缀，而星号 * 表示 IP 地址中的主机号，可以是任意值。 

**注意：**网络前缀越短，其地址块所包含的地址数就越多。

**最长前缀匹配：**

使用 CIDR 时，路由表中的每个项目由“网络前缀”和“下一跳地址”组成。在查找路由表时可能会得到不止一个匹配结果。 应当从匹配结果中选择具有最长网络前缀的路由：最长前缀匹配 (longest-prefix matching)。网络前缀越长，其地址块就越小，因而路由就越具体 (more specific) 。

如下所示：第二个匹配程度更高

<img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651986594.png" alt="image-20220508130953819" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651986610.png" alt="image-20220508131010280" style="zoom:80%;" />

## RFC 1918指明的专用IP地址

<img src="https://raw.githubusercontent.com/wqcblog/picgo-image/master/2022/05/20220508_1651987468.png" alt="image-20220508132428232" style="zoom:67%;" />